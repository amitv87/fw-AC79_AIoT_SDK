Index: app_main.c
===================================================================
--- app_main.c	(revision 1020)
+++ app_main.c	(working copy)
@@ -18,6 +18,22 @@
     {"sys_event",           29,     512,	   0 },
     {"systimer",            14,     256, 	   0 },
     {"sys_timer",            9,     512,	  128 },
+#if CPU_CORE_NUM > 1
+    {"#C0usb_msd",           1,      512,   128   },
+#else
+    {"usb_msd",              1,      512,   128   },
+#endif
+
+
+    {"audio_server",        16,      512,   64    },
+    {"audio_mix",           28,      512,   0     },
+    {"audio_encoder",       12,      384,   64    },
+
+
+    {"uac_sync",            20,      512,   0     },
+    {"uac_play",             7,      768,   0     },
+    {"uac_record",           7,      768,   32    },
+
 
     {0, 0, 0, 0, 0},
 };
@@ -29,7 +45,9 @@
 static void hello_demo_task(void *p)
 {
     while (1) {
-        os_time_dly(300);
+        os_time_dly(300);
+        int hid_keyboard_send(const u8 *data, u32 len);
+
     }
 }
 void app_main()
Index: board/AC790N_demo_hello.cbp
===================================================================
--- board/AC790N_demo_hello.cbp	(revision 1020)
+++ board/AC790N_demo_hello.cbp	(working copy)
@@ -1,242 +1,412 @@
-<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
+<?xml version="1.0" encoding="UTF-8" standalone="yes" ?>
 <CodeBlocks_project_file>
-<FileVersion major="1" minor="6" />
-<Project>
-<Option title="AC790N_DEMO_HELLO" />
-<Option compiler="pi32v2_r3_lto_compiler" />
-<Build>
-<Target title="Release">
-<Option output="../../../cpu/wl80/tools/sdk.elf" prefix_auto="0" extension_auto="0" />
-<Option object_output="obj/Release/" />
-<Option type="1" />
-<Option compiler="pi32v2_r3_lto_compiler" />
-<Compiler>
-<Add option="-Wuninitialized" />
-<Add option="-Wno-invalid-noreturn" />
-<Add option="-fno-common" />
-<Add option="-integrated-as" />
-<Add option="-Oz" />
-<Add option="-g" />
-<Add option="-flto" />
-<Add option="-fallow-pointer-null" />
-<Add option="-fprefer-gnu-section" />
-<Add option="-Wno-shift-negative-value" />
-<Add option="-fms-extensions" />
-<Add option="-DSUPPORT_MS_EXTENSIONS" />
-<Add option="-w" />
-<Add option="-DCONFIG_CPU_WL80" />
-<Add option="-DCONFIG_RELEASE_ENABLE" />
-<Add option="-DCONFIG_FREE_RTOS_ENABLE" />
-<Add option="-DCONFIG_SFC_ENABLE" />
-<Add option="-DCONFIG_NO_SDRAM_ENABLE" />
-<Add option="-DEVENT_HANDLER_NUM_CONFIG=2" />
-<Add option="-DEVENT_TOUCH_ENABLE_CONFIG=0" />
-<Add option="-DEVENT_POOL_SIZE_CONFIG=256" />
-<Add option="-DCONFIG_EVENT_KEY_MAP_ENABLE=0" />
-<Add option="-DTIMER_POOL_NUM_CONFIG=15" />
-<Add option="-DAPP_ASYNC_POOL_NUM_CONFIG=0" />
-<Add option="-DVFS_ENABLE=1" />
-<Add option="-DUSE_SDFILE_NEW=1" />
-<Add option="-DSDFILE_STORAGE=1" />
-<Add option="-DVFS_FILE_POOL_NUM_CONFIG=8" />
-<Add option="-DVM_MAX_SIZE_CONFIG=32*1024" />
-<Add option="-DVM_ITEM_MAX_NUM=256" />
-<Add option="-DCONFIG_UPDATA_ENABLE" />
-<Add option="-DCONFIG_OTA_UPDATA_ENABLE" />
-<Add option="-DCONFIG_ITEM_FORMAT_VM" />
-<Add option="-DCONFIG_THREAD_ENABLE" />
-<Add option="-DCONFIG_AUDIO_ONCHIP" />
-<Add option="-D__GCC_PI32V2__" />
-<Add option="-DCONFIG_NEW_ECC_ENABLE" />
-<Add directory="../../../include_lib" />
-<Add directory="../../../include_lib/driver" />
-<Add directory="../../../include_lib/driver/device" />
-<Add directory="../../../include_lib/driver/cpu/wl80" />
-<Add directory="../../../include_lib/system" />
-<Add directory="../../../include_lib/system/generic" />
-<Add directory="../../../include_lib/btctrler" />
-<Add directory="../../../include_lib/btctrler/port/wl80" />
-<Add directory="../../../include_lib/update" />
-<Add directory="../../../include_lib/btstack/third_party/common" />
-<Add directory="../../../include_lib/utils" />
-<Add directory="../../../include_lib/utils/syscfg" />
-<Add directory="../../../include_lib/utils/event" />
-<Add directory="../../../include_lib/btstack/third_party/rcsp" />
-<Add directory="../../../apps/demo_hello/include" />
-</Compiler>
-<Linker>
-<Add option="--plugin-opt=-pi32v2-always-use-itblock=false" />
-<Add option="--plugin-opt=-enable-ipra=true" />
-<Add option="--plugin-opt=-pi32v2-merge-max-offset=4096" />
-<Add option="--plugin-opt=-pi32v2-enable-simd=true" />
-<Add option="--plugin-opt=mcpu=r3" />
-<Add option="--plugin-opt=-global-merge-on-const" />
-<Add option="--plugin-opt=-inline-threshold=5" />
-<Add option="--plugin-opt=-inline-max-allocated-size=32" />
-<Add option="--plugin-opt=-inline-normal-into-special-section=true" />
-<Add option="--plugin-opt=-dont-used-symbol-list=malloc,free,sprintf,printf,puts,putchar" />
-<Add option="--plugin-opt=save-temps" />
-<Add option="--sort-common" />
-<Add option="--dont-complain-call-overflow" />
-<Add option="--plugin-opt=-used-symbol-file=../../../cpu/wl80/sdk_used_list.used" />
-<Add option="--plugin-opt=-pi32v2-large-program=true" />
-<Add option="--start-group" />
-<Add option="../../../include_lib/liba/wl80/cpu.a" />
-<Add option="../../../include_lib/liba/wl80/event.a" />
-<Add option="../../../include_lib/liba/wl80/system.a" />
-<Add option="../../../include_lib/liba/wl80/cfg_tool.a" />
-<Add option="../../../include_lib/liba/wl80/fs.a" />
-<Add option="../../../include_lib/liba/wl80/common_lib.a" />
-<Add option="--end-group" />
-<Add option="-T../../../cpu/wl80/sdk.ld" />
-<Add option="-M=../../../cpu/wl80/tools/sdk.map" />
-<Add library="C:\JL\pi32\pi32v2-lib\r3\libm.a" />
-</Linker>
-<ExtraCommands>
-<Add before="$compiler $options $includes -D__LD__ -E -P ..\..\..\cpu\wl80\sdk_used_list.c -o ..\..\..\cpu\wl80\sdk_used_list.used" />
-<Add before="$compiler $options $includes -D__LD__ -E -P ..\..\..\cpu\wl80\sdk_ld.c -o ..\..\..\cpu\wl80\sdk.ld" />
-<Mode before="always" />
-<Add after="..\..\..\cpu\wl80\tools\download.bat sdk" />
-<Mode after="always" />
-</ExtraCommands>
-</Target>
-</Build>
-<Unit filename="../../../apps/common/config/log_config/lib_driver_config.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/config/log_config/lib_system_config.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/config/user_cfg.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/debug/debug.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/debug/debug_user.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/system/init.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/system/system_reset_reason.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/common/system/version.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/demo_hello/app_main.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/demo_hello/board/board.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../apps/demo_hello/include/app_config.h" />
-<Unit filename="../../../cpu/wl80/debug.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../cpu/wl80/setup.c"><Option compilerVer="CC"/></Unit>
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/WL80.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/adc_api.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/aes_hw.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/audio.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/bus_device.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/cache.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/clock.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/cpu.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/crc16.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/csfr.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/dac.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/debug.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/device_drive.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/dma.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/emi.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/eq.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/gpio.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/hwi.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/iic.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/iis.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/image_enc.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imb_driver.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imc.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imd.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imr.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/includes.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/irq.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/isc.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/isp_alg.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/isp_dev.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/jpeg_codec.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/ladc.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/lock.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/p33.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/pap.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/plnk.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/port_waked_up.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/power_interface.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/pwm.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/pwm_led.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/rdec.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/rtc.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/sdmmc.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/sfc_norflash_api.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/sha_hw.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/spi.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/spiflash.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/src.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/startup.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/system_reset_reason.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/uart.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/uvc_device.h" />
-<Unit filename="../../../include_lib/driver/cpu/wl80/asm/wdt.h" />
-<Unit filename="../../../include_lib/driver/device/device.h" />
-<Unit filename="../../../include_lib/driver/device/gpio.h" />
-<Unit filename="../../../include_lib/driver/device/includes.h" />
-<Unit filename="../../../include_lib/driver/device/ioctl_cmds.h" />
-<Unit filename="../../../include_lib/driver/device/key/adkey.h" />
-<Unit filename="../../../include_lib/driver/device/key/ctmu_key.h" />
-<Unit filename="../../../include_lib/driver/device/key/iokey.h" />
-<Unit filename="../../../include_lib/driver/device/key/irkey.h" />
-<Unit filename="../../../include_lib/driver/device/key/key_driver.h" />
-<Unit filename="../../../include_lib/driver/device/key/rdec_key.h" />
-<Unit filename="../../../include_lib/driver/device/key/slidekey.h" />
-<Unit filename="../../../include_lib/driver/device/key/tent600_key.h" />
-<Unit filename="../../../include_lib/driver/device/key/touch_key.h" />
-<Unit filename="../../../include_lib/driver/device/sdio/sdmmc.h" />
-<Unit filename="../../../include_lib/driver/device/spiflash.h" />
-<Unit filename="../../../include_lib/driver/device/uart.h" />
-<Unit filename="../../../include_lib/driver/device/video/camera.h" />
-<Unit filename="../../../include_lib/driver/device/video/fb.h" />
-<Unit filename="../../../include_lib/driver/device/video/video.h" />
-<Unit filename="../../../include_lib/driver/device/video/video_ioctl.h" />
-<Unit filename="../../../include_lib/system/app_core.h" />
-<Unit filename="../../../include_lib/system/app_msg.h" />
-<Unit filename="../../../include_lib/system/bank_switch.h" />
-<Unit filename="../../../include_lib/system/debug.h" />
-<Unit filename="../../../include_lib/system/generic/ascii.h" />
-<Unit filename="../../../include_lib/system/generic/atomic.h" />
-<Unit filename="../../../include_lib/system/generic/circular_buf.h" />
-<Unit filename="../../../include_lib/system/generic/cpu.h" />
-<Unit filename="../../../include_lib/system/generic/debug_lite.h" />
-<Unit filename="../../../include_lib/system/generic/errno-base.h" />
-<Unit filename="../../../include_lib/system/generic/includes.h" />
-<Unit filename="../../../include_lib/system/generic/ioctl.h" />
-<Unit filename="../../../include_lib/system/generic/irq.h" />
-<Unit filename="../../../include_lib/system/generic/jiffies.h" />
-<Unit filename="../../../include_lib/system/generic/lbuf.h" />
-<Unit filename="../../../include_lib/system/generic/lbuf_lite.h" />
-<Unit filename="../../../include_lib/system/generic/list.h" />
-<Unit filename="../../../include_lib/system/generic/log.h" />
-<Unit filename="../../../include_lib/system/generic/printf.h" />
-<Unit filename="../../../include_lib/system/generic/rect.h" />
-<Unit filename="../../../include_lib/system/generic/typedef.h" />
-<Unit filename="../../../include_lib/system/generic/version.h" />
-<Unit filename="../../../include_lib/system/includes.h" />
-<Unit filename="../../../include_lib/system/init.h" />
-<Unit filename="../../../include_lib/system/malloc.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/FreeRTOS.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/FreeRTOSConfig.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/deprecated_definitions.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/list.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/mpu_wrappers.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/pi32v2/portmacro.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/portable.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/projdefs.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/queue.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/semphr.h" />
-<Unit filename="../../../include_lib/system/os/FreeRTOS/task.h" />
-<Unit filename="../../../include_lib/system/os/os_api.h" />
-<Unit filename="../../../include_lib/system/os/os_cpu.h" />
-<Unit filename="../../../include_lib/system/os/os_error.h" />
-<Unit filename="../../../include_lib/system/os/os_type.h" />
-<Unit filename="../../../include_lib/system/spinlock.h" />
-<Unit filename="../../../include_lib/system/sys_time.h" />
-<Unit filename="../../../include_lib/system/task.h" />
-<Unit filename="../../../include_lib/system/timer.h" />
-<Unit filename="../../../include_lib/system/wait.h" />
-<Unit filename="../../../include_lib/utils/event/event.h" />
-<Unit filename="../../../include_lib/utils/event/key_event.h" />
-<Unit filename="../../../include_lib/utils/fs/fs.h" />
-<Unit filename="../../../include_lib/utils/fs/fs_file_name.h" />
-<Unit filename="../../../include_lib/utils/fs/sdfile.h" />
-<Unit filename="../../../include_lib/utils/syscfg/syscfg_id.h" />
-</Project>
+	<FileVersion major="1" minor="6" />
+	<Project>
+		<Option title="AC790N_DEMO_HELLO" />
+		<Option compiler="pi32v2_r3_lto_compiler" />
+		<Build>
+			<Target title="Release">
+				<Option output="../../../cpu/wl80/tools/sdk.elf" prefix_auto="0" extension_auto="0" />
+				<Option object_output="obj/Release/" />
+				<Option type="1" />
+				<Option compiler="pi32v2_r3_lto_compiler" />
+				<Compiler>
+					<Add option="-Wuninitialized" />
+					<Add option="-Wno-invalid-noreturn" />
+					<Add option="-fno-common" />
+					<Add option="-integrated-as" />
+					<Add option="-Oz" />
+					<Add option="-g" />
+					<Add option="-flto" />
+					<Add option="-fallow-pointer-null" />
+					<Add option="-fprefer-gnu-section" />
+					<Add option="-Wno-shift-negative-value" />
+					<Add option="-fms-extensions" />
+					<Add option="-w" />
+					<Add option="-DSUPPORT_MS_EXTENSIONS" />
+					<Add option="-DCONFIG_CPU_WL80" />
+					<Add option="-DCONFIG_FREE_RTOS_ENABLE" />
+					<Add option="-DCONFIG_SFC_ENABLE" />
+					<Add option="-DEVENT_HANDLER_NUM_CONFIG=2" />
+					<Add option="-DEVENT_TOUCH_ENABLE_CONFIG=0" />
+					<Add option="-DEVENT_POOL_SIZE_CONFIG=256" />
+					<Add option="-DCONFIG_EVENT_KEY_MAP_ENABLE=0" />
+					<Add option="-DTIMER_POOL_NUM_CONFIG=15" />
+					<Add option="-DAPP_ASYNC_POOL_NUM_CONFIG=0" />
+					<Add option="-DVFS_ENABLE=1" />
+					<Add option="-DUSE_SDFILE_NEW=1" />
+					<Add option="-DSDFILE_STORAGE=1" />
+					<Add option="-DVFS_FILE_POOL_NUM_CONFIG=8" />
+					<Add option="-DFS_VERSION=0x020001" />
+					<Add option="-DFATFS_VERSION=0x020101" />
+					<Add option="-DSDFILE_VERSION=0x020000" />
+					<Add option="-DVM_MAX_SIZE_CONFIG=32*1024" />
+					<Add option="-DVM_ITEM_MAX_NUM=256" />
+					<Add option="-DCONFIG_UPDATA_ENABLE" />
+					<Add option="-DCONFIG_OTA_UPDATA_ENABLE" />
+					<Add option="-DCONFIG_ITEM_FORMAT_VM" />
+					<Add option="-DCONFIG_THREAD_ENABLE" />
+					<Add option="-DCONFIG_AUDIO_ONCHIP" />
+					<Add option="-D__GCC_PI32V2__" />
+					<Add option="-DCONFIG_NEW_ECC_ENABLE" />
+					<Add directory="../../../include_lib" />
+					<Add directory="../../../include_lib/driver" />
+					<Add directory="../../../include_lib/driver/device" />
+					<Add directory="../../../include_lib/driver/cpu/wl80" />
+					<Add directory="../../../include_lib/system" />
+					<Add directory="../../../include_lib/system/generic" />
+					<Add directory="../../../include_lib/btctrler" />
+					<Add directory="../../../include_lib/btctrler/port/wl80" />
+					<Add directory="../../../include_lib/update" />
+					<Add directory="../../../include_lib/btstack/third_party/common" />
+					<Add directory="../../../include_lib/utils" />
+					<Add directory="../../../include_lib/utils/syscfg" />
+					<Add directory="../../../include_lib/utils/event" />
+					<Add directory="../../../include_lib/btstack/third_party/rcsp" />
+					<Add directory="../../../apps/demo_hello/include" />
+					<Add directory="../../common/usb" />
+					<Add directory="../../common/usb/include" />
+					<Add directory="../../common" />
+					<Add directory="../../common/usb/host" />
+					<Add directory="../../common/usb/device" />
+					<Add directory="../../common/usb/include/host" />
+					<Add directory="../../../include_lib/driver/device/usb" />
+					<Add directory="../../../include_lib/driver/device/usb/host" />
+					<Add directory="../../../include_lib/driver/device/usb/device" />
+					<Add directory="../../../include_lib/net" />
+					<Add directory="../../../include_lib/net/server" />
+					<Add directory="../../../include_lib/server" />
+					<Add directory="../../../include_lib/net/lwip/src/include" />
+					<Add directory="../../../include_lib/net/lwip/src/include/lwip" />
+					<Add directory="../../../include_lib/net/lwip/port" />
+					<Add directory="../../../include_lib/net/lwip/app" />
+					<Add directory="../../../include_lib/driver/device/video" />
+				</Compiler>
+				<Linker>
+					<Add option="--plugin-opt=-pi32v2-always-use-itblock=false" />
+					<Add option="--plugin-opt=-enable-ipra=true" />
+					<Add option="--plugin-opt=-pi32v2-merge-max-offset=4096" />
+					<Add option="--plugin-opt=-pi32v2-enable-simd=true" />
+					<Add option="--plugin-opt=mcpu=r3" />
+					<Add option="--plugin-opt=-global-merge-on-const" />
+					<Add option="--plugin-opt=-inline-threshold=5" />
+					<Add option="--plugin-opt=-inline-max-allocated-size=32" />
+					<Add option="--plugin-opt=-inline-normal-into-special-section=true" />
+					<Add option="--plugin-opt=-dont-used-symbol-list=malloc,free,sprintf,printf,puts,putchar" />
+					<Add option="--plugin-opt=save-temps" />
+					<Add option="--sort-common" />
+					<Add option="--dont-complain-call-overflow" />
+					<Add option="--plugin-opt=-used-symbol-file=../../../cpu/wl80/sdk_used_list.used" />
+					<Add option="--plugin-opt=-pi32v2-large-program=true" />
+					<Add option="--start-group" />
+					<Add option="../../../include_lib/liba/wl80/cpu.a" />
+					<Add option="../../../include_lib/liba/wl80/event.a" />
+					<Add option="../../../include_lib/liba/wl80/system.a" />
+					<Add option="../../../include_lib/liba/wl80/cfg_tool.a" />
+					<Add option="../../../include_lib/liba/wl80/fs.a" />
+					<Add option="../../../include_lib/liba/wl80/common_lib.a" />
+					<Add option="../../../include_lib/liba/wl80/lib_usb_syn.a" />
+					<Add option="../../../include_lib/liba/wl80/audio_server.a" />
+					<Add option="../../../include_lib/liba/wl80/video_rec_server.a" />
+					<Add option="../../../include_lib/liba/wl80/net_server.a" />
+					<Add option="--end-group" />
+					<Add option="-T../../../cpu/wl80/sdk.ld" />
+					<Add option="-M=../../../cpu/wl80/tools/sdk.map" />
+					<Add library="C:/JL/pi32/pi32v2-lib/r3/libm.a" />
+				</Linker>
+				<ExtraCommands>
+					<Add before="$compiler $options $includes -D__LD__ -E -P ..\..\..\cpu\wl80\sdk_used_list.c -o ..\..\..\cpu\wl80\sdk_used_list.used" />
+					<Add before="$compiler $options $includes -D__LD__ -E -P ..\..\..\cpu\wl80\sdk_ld.c -o ..\..\..\cpu\wl80\sdk.ld" />
+					<Add after="..\..\..\cpu\wl80\tools\download.bat sdk" />
+					<Mode after="always" />
+				</ExtraCommands>
+			</Target>
+		</Build>
+		<Unit filename="../../../cpu/wl80/debug.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../../cpu/wl80/key/adc_api.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../../cpu/wl80/setup.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/WL80.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/adc_api.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/audio.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/bus_device.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/cache.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/clock.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/cpu.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/crc16.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/csfr.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/ctmu.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/dac.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/debug.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/device_drive.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/dma.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/efuse.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/emi.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/eq.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/gpio.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/hwi.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/iic.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/iis.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/image_enc.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imb_driver.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imc.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imd.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/imr.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/includes.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/irq.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/isc.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/isp_alg.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/isp_dev.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/jpeg_codec.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/ladc.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/lock.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/p33.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/pap.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/plcnt.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/plnk.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/port_waked_up.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/power_interface.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/pwm.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/pwm_led.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/rdec.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/rtc.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/sdmmc.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/sfc_norflash_api.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/spi.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/spiflash.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/src.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/startup.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/system_reset_reason.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/uart.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/uvc_device.h" />
+		<Unit filename="../../../include_lib/driver/cpu/wl80/asm/wdt.h" />
+		<Unit filename="../../../include_lib/driver/device/device.h" />
+		<Unit filename="../../../include_lib/driver/device/gpio.h" />
+		<Unit filename="../../../include_lib/driver/device/iic.h" />
+		<Unit filename="../../../include_lib/driver/device/includes.h" />
+		<Unit filename="../../../include_lib/driver/device/ioctl_cmds.h" />
+		<Unit filename="../../../include_lib/driver/device/key/adkey.h" />
+		<Unit filename="../../../include_lib/driver/device/key/ctmu_key.h" />
+		<Unit filename="../../../include_lib/driver/device/key/iokey.h" />
+		<Unit filename="../../../include_lib/driver/device/key/irkey.h" />
+		<Unit filename="../../../include_lib/driver/device/key/key_driver.h" />
+		<Unit filename="../../../include_lib/driver/device/key/rdec_key.h" />
+		<Unit filename="../../../include_lib/driver/device/key/slidekey.h" />
+		<Unit filename="../../../include_lib/driver/device/key/tent600_key.h" />
+		<Unit filename="../../../include_lib/driver/device/key/touch_key.h" />
+		<Unit filename="../../../include_lib/driver/device/sdio/sdmmc.h" />
+		<Unit filename="../../../include_lib/driver/device/spiflash.h" />
+		<Unit filename="../../../include_lib/driver/device/uart.h" />
+		<Unit filename="../../../include_lib/driver/device/video/camera.h" />
+		<Unit filename="../../../include_lib/driver/device/video/fb.h" />
+		<Unit filename="../../../include_lib/driver/device/video/video.h" />
+		<Unit filename="../../../include_lib/driver/device/video/video_ioctl.h" />
+		<Unit filename="../../../include_lib/system/app_core.h" />
+		<Unit filename="../../../include_lib/system/app_msg.h" />
+		<Unit filename="../../../include_lib/system/bank_switch.h" />
+		<Unit filename="../../../include_lib/system/debug.h" />
+		<Unit filename="../../../include_lib/system/generic/ascii.h" />
+		<Unit filename="../../../include_lib/system/generic/atomic.h" />
+		<Unit filename="../../../include_lib/system/generic/circular_buf.h" />
+		<Unit filename="../../../include_lib/system/generic/cpu.h" />
+		<Unit filename="../../../include_lib/system/generic/debug_lite.h" />
+		<Unit filename="../../../include_lib/system/generic/errno-base.h" />
+		<Unit filename="../../../include_lib/system/generic/includes.h" />
+		<Unit filename="../../../include_lib/system/generic/ioctl.h" />
+		<Unit filename="../../../include_lib/system/generic/irq.h" />
+		<Unit filename="../../../include_lib/system/generic/jiffies.h" />
+		<Unit filename="../../../include_lib/system/generic/lbuf.h" />
+		<Unit filename="../../../include_lib/system/generic/lbuf_lite.h" />
+		<Unit filename="../../../include_lib/system/generic/list.h" />
+		<Unit filename="../../../include_lib/system/generic/log.h" />
+		<Unit filename="../../../include_lib/system/generic/printf.h" />
+		<Unit filename="../../../include_lib/system/generic/rect.h" />
+		<Unit filename="../../../include_lib/system/generic/typedef.h" />
+		<Unit filename="../../../include_lib/system/generic/version.h" />
+		<Unit filename="../../../include_lib/system/includes.h" />
+		<Unit filename="../../../include_lib/system/init.h" />
+		<Unit filename="../../../include_lib/system/malloc.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/FreeRTOS.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/FreeRTOSConfig.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/deprecated_definitions.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/list.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/mpu_wrappers.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/pi32v2/portmacro.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/portable.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/projdefs.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/queue.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/semphr.h" />
+		<Unit filename="../../../include_lib/system/os/FreeRTOS/task.h" />
+		<Unit filename="../../../include_lib/system/os/os_api.h" />
+		<Unit filename="../../../include_lib/system/os/os_cpu.h" />
+		<Unit filename="../../../include_lib/system/os/os_error.h" />
+		<Unit filename="../../../include_lib/system/os/os_type.h" />
+		<Unit filename="../../../include_lib/system/spinlock.h" />
+		<Unit filename="../../../include_lib/system/sys_time.h" />
+		<Unit filename="../../../include_lib/system/task.h" />
+		<Unit filename="../../../include_lib/system/timer.h" />
+		<Unit filename="../../../include_lib/system/wait.h" />
+		<Unit filename="../../../include_lib/utils/event/event.h" />
+		<Unit filename="../../../include_lib/utils/event/key_event.h" />
+		<Unit filename="../../../include_lib/utils/fs/fs.h" />
+		<Unit filename="../../../include_lib/utils/fs/fs_file_name.h" />
+		<Unit filename="../../../include_lib/utils/fs/sdfile.h" />
+		<Unit filename="../../../include_lib/utils/syscfg/syscfg_id.h" />
+		<Unit filename="../../common/audio_music/audio_config.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/audio_music/usb_audio_api.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/camera/gc0308_dvp/gc0308.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/config/log_config/lib_driver_config.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/config/log_config/lib_system_config.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/config/user_cfg.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/debug/debug.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/iic/iic.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/iic/software_iic.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/system/device_mount.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/system/init.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/system/system_reset_reason.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/system/version.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/cdc.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/cdc.h" />
+		<Unit filename="../../common/usb/device/cdc_defs.h" />
+		<Unit filename="../../common/usb/device/descriptor.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/hid.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/msd.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/msd_upgrade.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/slave_uvc.h" />
+		<Unit filename="../../common/usb/device/task_pc.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/uac.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/uac_stream.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/uac_stream.h" />
+		<Unit filename="../../common/usb/device/usb_device.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/usb_video.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/user_setup.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/device/uvc.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/adb.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/adb.h" />
+		<Unit filename="../../common/usb/host/adb_rsa_key.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/aoa.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/aoa.h" />
+		<Unit filename="../../common/usb/host/apple_mfi.h" />
+		<Unit filename="../../common/usb/host/audio.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/audio.h" />
+		<Unit filename="../../common/usb/host/audio_demo.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/hid.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/hid.h" />
+		<Unit filename="../../common/usb/host/usb_bulk_transfer.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/usb_bulk_transfer.h" />
+		<Unit filename="../../common/usb/host/usb_ctrl_transfer.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/usb_ctrl_transfer.h" />
+		<Unit filename="../../common/usb/host/usb_hid_keys.h" />
+		<Unit filename="../../common/usb/host/usb_host.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/usb_storage.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/host/usb_storage.h" />
+		<Unit filename="../../common/usb/host/uvc_host.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/usb_common_def.h" />
+		<Unit filename="../../common/usb/usb_config.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/usb_config.h" />
+		<Unit filename="../../common/usb/usb_host_config.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../../common/usb/usb_std_class_def.h" />
+		<Unit filename="../app_main.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../include/app_config.h" />
+		<Unit filename="../stream_protocol.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../user_video_rec.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="../video_rt_usr.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Unit filename="board.c">
+			<Option compilerVar="CC" />
+		</Unit>
+		<Extensions>
+			<code_completion />
+			<envvars />
+			<debugger />
+		</Extensions>
+	</Project>
 </CodeBlocks_project_file>
Index: board/board.c
===================================================================
--- board/board.c	(revision 1020)
+++ board/board.c	(working copy)
@@ -2,7 +2,23 @@
 
 #include "system/includes.h"
 #include "device/includes.h"
-#include "asm/includes.h"
+#include "asm/includes.h"
+
+#include "server/audio_dev.h"
+
+
+#if TCFG_USB_SLAVE_ENABLE || TCFG_USB_HOST_ENABLE
+#include "otg.h"
+#include "usb_host.h"
+#include "usb_common_def.h"
+#include "usb_storage.h"
+#include "asm/uvc_device.h"
+#endif
+
+
+#include "device/iic.h"
+
+
 
 // *INDENT-OFF*
 
@@ -11,7 +27,7 @@
 	.baudrate = 1000000,
 	.port = PORT_REMAP,
 	.output_channel = OUTPUT_CHANNEL0,
-	.tx_pin = IO_PORTC_00,
+	.tx_pin = IO_PORTC_06,
 	.rx_pin = -1,
 	.max_continue_recv_cnt = 1024,
 	.idle_sys_clk_cnt = 500000,
@@ -18,10 +34,245 @@
 	.clk_src = PLL_48M,
 	.flags = UART_DEBUG,
 UART2_PLATFORM_DATA_END();
+
+
+/****************SDƒ£øÈ**********************************************************
+ * ‘›÷ª÷ß≥÷1∏ˆSDÕ‚…Ë£¨»Á–Ë“™∂‡∏ˆSDÕ‚…Ë£¨◊‘––»•µÙœ¬√ÊSD0/1_ENABLEøÿ÷∆£¨¡ÌÕ‚∂®“Âº¥ø…
+********************************************************************************/
+#if TCFG_SD0_ENABLE
+//sd0
+#define SD_PLATFORM_DATA_BEGIN() SD0_PLATFORM_DATA_BEGIN(sd0_data)
+#define SD_PLATFORM_DATA_END() SD0_PLATFORM_DATA_END()
+#define SD_CLK_DETECT_FUNC		sdmmc_0_clk_detect
+#elif TCFG_SD1_ENABLE
+//sd1
+#define SD_PLATFORM_DATA_BEGIN() SD1_PLATFORM_DATA_BEGIN(sd1_data)
+#define SD_PLATFORM_DATA_END() SD1_PLATFORM_DATA_END()
+#define SD_CLK_DETECT_FUNC		sdmmc_1_clk_detect
+#endif
+
+SD_PLATFORM_DATA_BEGIN()
+	.port 					= TCFG_SD_PORTS,
+	.priority 				= 3,
+	.data_width 			= TCFG_SD_DAT_WIDTH,
+	.speed 					= TCFG_SD_CLK,
+	.detect_mode 			= TCFG_SD_DET_MODE,
+#if (TCFG_SD_DET_MODE == SD_CLK_DECT)
+	.detect_func 			= SD_CLK_DETECT_FUNC,
+#elif (TCFG_SD_DET_MODE == SD_IO_DECT)
+	.detect_func 			= sdmmc_0_io_detect,
+#else
+	.detect_func 			= NULL,
+#endif
+SD_PLATFORM_DATA_END()
+/****************SDƒ£øÈ*********************/
+
+#if TCFG_USB_SLAVE_ENABLE || TCFG_USB_HOST_ENABLE
+static const struct otg_dev_data otg_data = {
+    .usb_dev_en = 0x01,
+#if TCFG_USB_SLAVE_ENABLE
+    .slave_online_cnt = 10,
+    .slave_offline_cnt = 10,
+#endif
+#if TCFG_USB_HOST_ENABLE
+    .host_online_cnt = 10,
+	.host_offline_cnt = 10,
+#endif
+	.detect_mode = OTG_HOST_MODE | OTG_SLAVE_MODE | OTG_CHARGE_MODE,
+    .detect_time_interval = 30,
+};
+#endif
+
+static const struct dac_platform_data dac_data = {
+    .ldo_id = 1,
+    .pa_mute_port = 0xff,
+    .pa_mute_value = 0,
+    .differ_output = 0,
+    .hw_channel = 0x01,
+    .ch_num = 1,	//≤Ó∑÷÷ª–Ëø™“ª∏ˆÕ®µ¿
+#ifdef CONFIG_DEC_ANALOG_VOLUME_ENABLE
+    .fade_enable = 1,
+    .fade_delay_ms = 40,
+#endif
+};
+static const struct adc_platform_data adc_data = {
+#ifdef CONFIG_ALL_ADC_CHANNEL_OPEN_ENABLE
+    .mic_channel = LADC_CH_MIC1_P_N,
+    .linein_channel = LADC_CH_AUX3,
+    .mic_ch_num = 1,
+    .linein_ch_num = 1,
+    .all_channel_open = 1,
+#else
+    .mic_channel = LADC_CH_MIC1_P_N,
+    .linein_channel = LADC_CH_AUX3,
+    .fake_channel = BIT(0),
+    .mic_ch_num = 1,
+    .linein_ch_num = 1,
+    .fake_ch_num = 1,
+#endif
+    .isel = 2,
+};
+static const struct iis_platform_data iis0_data = {
+    .channel_in = BIT(0),
+    .channel_out = 0,
+    .port_sel = IIS_PORTA,
+    .data_width = 0,
+    .mclk_output = 0,
+    .slave_mode = 0,
+};
+static const struct iis_platform_data iis1_data = {
+    .channel_in = BIT(3),
+    .channel_out = 0,
+    .port_sel = IIS_PORTA,
+    .data_width = 0,
+    .mclk_output = 0,
+    .slave_mode = 0,
+};
+static void plnk0_port_remap_cb(void)
+{
+    extern int gpio_plnk_rx_input(u32 gpio, u8 index, u8 data_sel);
+    gpio_plnk_rx_input(IO_PORTH_04, 0, 0);
+    gpio_direction_output(IO_PORTC_00, 0);
+    gpio_output_channle(IO_PORTC_00, CH0_PLNK0_SCLK_OUT);	//SCLK0 π”√outputchannel0
+    JL_IOMAP->CON3 |= BIT(18);
+}
+
+static void plnk0_port_unremap_cb(void)
+{
+    JL_IOMAP->CON3 &= ~BIT(18);
+    gpio_clear_output_channle(IO_PORTC_00, CH0_PLNK0_SCLK_OUT);
+}
+//plnkµƒ ±÷”∫Õ ˝æ›“˝Ω≈∂º≤…”√÷ÿ”≥…‰µƒ π”√¿˝◊”
+static const struct plnk_platform_data plnk0_data = {
+    .hw_channel = PLNK_CH_MIC_L,
+    .clk_out = 1,
+    .port_remap_cb = plnk0_port_remap_cb,
+    .port_unremap_cb = plnk0_port_unremap_cb,
+    .sample_edge = 0,   //‘⁄CLKµƒœ¬Ωµ—ÿ≤…—˘◊ÛMIC
+    .share_data_io = 1, //¡Ω∏ˆ ˝◊÷MICπ≤”√“ª∏ˆDATΩ≈
+    .high_gain = 1,
+    .dc_cancelling_filter = 14,
+};
+static const struct plnk_platform_data plnk1_data = {
+    .hw_channel = PLNK_CH_MIC_R,
+    /* .hw_channel = PLNK_CH_MIC_DOUBLE, */
+    .clk_out = 1,
+    .port_remap_cb = NULL,
+    .dc_cancelling_filter = 14,
+};
+static const struct audio_pf_data audio_pf_d = {
+    .adc_pf_data = &adc_data,
+    .dac_pf_data = &dac_data,
+    .iis0_pf_data = &iis0_data,
+    .iis1_pf_data = &iis1_data,
+    .plnk0_pf_data = &plnk0_data,
+    .plnk1_pf_data = &plnk1_data,
+};
+static const struct audio_platform_data audio_data = {
+    .private_data = (void *) &audio_pf_d,
+};
+
+
+
+/*
+ *…„œÒÕ∑IIC
+ */
+SW_IIC_PLATFORM_DATA_BEGIN(sw_iic0_data)
+	/*.clk_pin = IO_PORTA_03,*/
+	/*.dat_pin = IO_PORTA_04,*/
+	.clk_pin = IO_PORTC_01,
+	.dat_pin = IO_PORTC_02,
+	.sw_iic_delay = 50,
+SW_IIC_PLATFORM_DATA_END()
 
-REGISTER_DEVICES(device_table) = {
+
+/*
+ *…„œÒÕ∑IO-PORT
+ */
+
+#define CAMERA_GROUP_PORT	ISC_GROUPA
+/* #define CAMERA_GROUP_PORT	ISC_GROUPC */
+static const struct camera_platform_data camera0_data = {
+    .xclk_gpio      = IO_PORTC_00,//◊¢“‚£∫ »Áπ˚”≤º˛xclkΩ”µΩ–æ∆¨IO£¨‘Úª·’º”√OUTPUT_CHANNEL1
+    .reset_gpio     = IO_PORTC_03,
+    .online_detect  = NULL,
+    .pwdn_gpio      = -1,
+    .power_value    = 0,
+    .interface      = SEN_INTERFACE0,//SEN_INTERFACE_CSI2,
+    .dvp={
+#if (CAMERA_GROUP_PORT == ISC_GROUPA)
+        .pclk_gpio   = IO_PORTA_08,
+        .hsync_gpio  = IO_PORTA_09,
+        .vsync_gpio  = IO_PORTA_10,
+#else
+        .pclk_gpio   = IO_PORTC_08,
+        .hsync_gpio  = IO_PORTC_09,
+        .vsync_gpio  = IO_PORTC_10,
+#endif
+		.group_port  = CAMERA_GROUP_PORT,
+        .data_gpio={
+#if (CAMERA_GROUP_PORT == ISC_GROUPA)
+                IO_PORTA_07,
+                IO_PORTA_06,
+                IO_PORTA_05,
+                IO_PORTA_04,
+                IO_PORTA_03,
+                IO_PORTA_02,
+                IO_PORTA_01,
+                IO_PORTA_00,
+				-1,
+				-1,
+#else
+                IO_PORTC_07,
+                IO_PORTC_06,
+                IO_PORTC_05,
+                IO_PORTC_04,
+                IO_PORTC_03,
+                IO_PORTC_02,
+                IO_PORTC_01,
+                IO_PORTC_00,
+				-1,
+				-1,
+#endif
+        },
+    }
+};
+static const struct video_subdevice_data video0_subdev_data[] = {
+    { VIDEO_TAG_CAMERA, (void *)&camera0_data },
+};
+static const struct video_platform_data video0_data = {
+    .data = video0_subdev_data,
+    .num = ARRAY_SIZE(video0_subdev_data),
+};
+
+
+
+
+
+REGISTER_DEVICES(device_table) = {
+
 	{"uart2", &uart_dev_ops, (void *)&uart2_data },
-	{"rtc", &rtc_dev_ops, NULL},
+	{"rtc", &rtc_dev_ops, NULL},
+#if TCFG_SD0_ENABLE
+	{"sd0",&sd_dev_ops,&sd0_data},
+#endif
+#if TCFG_UDISK_ENABLE
+    { "udisk", &mass_storage_ops, NULL },
+#endif
+#if TCFG_USB_SLAVE_ENABLE || TCFG_USB_HOST_ENABLE
+	 { "otg", &usb_dev_ops, (void *)&otg_data},
+#endif
+
+    { "audio", &audio_dev_ops, (void *)&audio_data },
+
+
+
+    { "iic0",  &iic_dev_ops, (void *)&sw_iic0_data },
+	{ "audio", &audio_dev_ops, (void *)&audio_data },
+
+    { "video0.*",  &video_dev_ops, (void *)&video0_data },
+
+
 };
 
 #ifdef CONFIG_DEBUG_ENABLE
@@ -30,9 +281,12 @@
     uart_init(&uart2_data);
 }
 #endif
+
+void board_early_init()
+{
+    extern void dac_early_init(u8 trim_en, u8 pwr_sel, u32 dly_msecs);
+    dac_early_init(1, 1, 1000);
+    devices_init();
+}
+
 
-void board_early_init()
-{
-    devices_init();
-}
-
Index: hid_keyboard.c
===================================================================
--- hid_keyboard.c	(nonexistent)
+++ hid_keyboard.c	(working copy)
@@ -0,0 +1,435 @@
+#include "app_config.h"
+#include "typedef.h"
+#include "usb_stack.h"
+#include "device/hid.h"
+#include "generic/jiffies.h"
+//#include "le_common.h"
+
+#if USB_HID_KEYBOARD_ENABLE
+
+#define KB_LED_NUM_LOCK             0x01
+#define KB_LED_CAPS_LOCK            0x02
+#define KB_LED_SCROLL_LOCK          0x04
+#define KB_LED_COMPOSE              0x08
+#define KB_LED_KANA                 0x10
+
+struct usb_hid_keyboard {
+    usb_dev usb_id;
+    u8 kb_leds_sta;
+};
+
+static struct usb_hid_keyboard hid_kb = {
+    .usb_id = -1,
+};
+
+static struct usb_hid_keyboard *const __this = &hid_kb;
+
+
+static const u8 report_keyboard[] = {
+    0x05, 0x01,
+    0x09, 0x06,
+    0xa1, 0x01,
+    0x05, 0x07,
+    0x19, 0xe0,
+    0x29, 0xe7,
+    0x15, 0x00,
+    0x25, 0x01,
+    0x75, 0x01,
+    0x95, 0x08,
+    0x81, 0x02,
+    0x95, 0x01,
+    0x75, 0x08,
+    0x81, 0x01,
+    0x95, 0x06,
+    0x75, 0x08,
+    0x15, 0x00,
+    0x25, 0x65,
+    0x05, 0x07,
+    0x19, 0x00,
+    0x29, 0x65,
+    0x81, 0x00,
+#if 1  //OUTPUT
+    0x95, 0x05,
+    0x75, 0x01,
+    0x05, 0x08,
+    0x19, 0x01,
+    0x29, 0x05,
+    0x91, 0x02,
+    0x95, 0x01,
+    0x75, 0x03,
+    0x91, 0x03,
+#endif
+    0xc0,
+};
+static const u16 ascii2kb_remap[128] = {
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x002a,  0x002b,  0x0028,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  // 0 ~ 15
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  // 16 ~ 31
+    0x002c,  0x011e,  0x0134,  0x0120,  0x0121,  0x0122,  0x0124,  0x0034,  0x0126,  0x0127,  0x0125,  0x012e,  0x0036,  0x002d,  0x0037,  0x0038,  // 32 ~ 47
+    0x0027,  0x001e,  0x001f,  0x0020,  0x0021,  0x0022,  0x0023,  0x0024,  0x0025,  0x0026,  0x0133,  0x0033,  0x0136,  0x002e,  0x0137,  0x0138,  // 48 ~ 63
+    0x011f,  0x0104,  0x0105,  0x0106,  0x0107,  0x0108,  0x0109,  0x010a,  0x010b,  0x010c,  0x010d,  0x010e,  0x010f,  0x0110,  0x0111,  0x0112,  // 64 ~ 79
+    0x0113,  0x0114,  0x0115,  0x0116,  0x0117,  0x0118,  0x0119,  0x011a,  0x011b,  0x011c,  0x011d,  0x002f,  0x0031,  0x0030,  0x0123,  0x012d,  // 80 ~ 95
+    0x0035,  0x0004,  0x0005,  0x0006,  0x0007,  0x0008,  0x0009,  0x000a,  0x000b,  0x000c,  0x000d,  0x000e,  0x000f,  0x0010,  0x0011,  0x0012,  // 96 ~ 111
+    0x0013,  0x0014,  0x0015,  0x0016,  0x0017,  0x0018,  0x0019,  0x001a,  0x001b,  0x001c,  0x001d,  0x012f,  0x0131,  0x0130,  0x0135,  0x0000,  // 112 ~ 127
+};
+static const u16 ascii2kp_remap[128] = {
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0058,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 0 ~ 15
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 16 ~ 31
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0055,  0x0057,  0x0000,  0x0056,  0x0063,  0x0054,   // 32 ~ 47
+    0x0062,  0x0059,  0x005A,  0x005B,  0x005C,  0x005D,  0x005E,  0x005F,  0x0060,  0x0061,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 48 ~ 63
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 64 ~ 79
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 80 ~ 95
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 96 ~ 111
+    0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,  0x0000,   // 112 ~ 127
+};
+
+
+static u32 hid_write_data(usb_dev usb_id, const u8 *buf, u32 len)
+{
+    int ret = -1;
+
+    /* printf("\n usb_id = %d\n",usb_id); */
+    if (-1 != usb_id) {
+#if 1
+        ret = hid_send_buf_async(usb_id, buf, len);
+#else
+        ret = hid_tx_data(__this->usb_id, buf, len);
+#endif
+        return ret;
+    }
+#ifdef CONFIG_BT_ENABLE
+    extern int bt_tx_data(void *priv, u8 * data, u16 len);
+    extern int bt_is_connect(void);
+    if (bt_is_connect()) {
+        ret = bt_tx_data(NULL, buf, len);
+        delay(0x10); //Ê†πÊçÆÊÉÖÂÜµÂª∂Êó∂‰∏ÄÁÇπ,Âê¶ÂàôÂÆπÊòìÂá∫Áé∞BUFÊª°
+        /* os_time_dly(1); */
+        if (ret == BLE_BUFFER_FULL) {
+            log_w("BLE_BUFFER_FULL"); //Â¢ûÂ§ßle_hogp.c‰∏≠ ATT_SEND_CBUF_SIZEÁöÑÂÄº
+        }
+    }
+#endif
+    return ret;
+}
+
+u8 *hid_keyboard_get_report_desc()
+{
+    return (u8 *)report_keyboard;
+}
+
+u32 hid_keyboard_get_report_desc_size()
+{
+    return sizeof(report_keyboard);
+}
+
+int inter2string(int value, char *s, int len)
+{
+    char tmp;
+    int count = 0;
+    char symbol = 0;
+
+    if (s == NULL) {
+        return -1;
+    }
+    if (value < 0) {
+        value = -value;
+        symbol = 1;
+    }
+    do {
+        s[count++] = value % 10 + '0';
+        value = value / 10;
+    } while (value != 0 && count < len);
+    if (count > len - 1 - symbol) {
+        return -2;
+    }
+    if (symbol) {
+        s[count] = '-';
+        s[count + 1] = 0;
+        count++;
+    } else {
+        s[count] = 0;
+    }
+    len = count;
+    for (count = 0; count < len / 2; count++) {
+        tmp = s[count];
+        s[count] = s[len - 1 - count];
+        s[len - 1 - count] = tmp;
+    }
+    return len;
+}
+
+int string2inter(const char *s, int len, int *val)
+{
+    char *p = (char *)s;
+    char symbol = 0;
+    char radix = 10;  //ËøõÂà∂ÔºåÂèñÂÄº‰∏∫16,10,8
+    int err = 0;
+
+    if (!p) {
+        return -1;
+    }
+
+    if (*p == '-') {
+        symbol = 1;
+        p++;
+        radix = 10;
+    } else if (*p == '+') {
+        symbol = 0;
+        p++;
+        radix = 10;
+    } else if (*p == '0' && len >= 2 && (*(p + 1) == 'x' || *(p + 1) == 'X')) {
+        radix = 16;
+        while (*p != 0) {
+            //upper to lower
+            if (*p >= 'A' && *p <= 'Z') {
+                *p += 'a' - 'A';
+            }
+            p++;
+        }
+        p = (char *)s + 2;
+    } else if (*p == '0' && len >= 2 && *(p + 1) != 'x' && *(p + 1) != 'X') {
+        radix = 8;
+        p++;
+    }
+    *val = 0;
+    while (*p && len--) {
+        if (radix == 16) {
+            if (*p >= '0' && *p <= '9') {
+                *val *= 16;
+                *val += *p - '0';
+            } else if (*p >= 'a' && *p <= 'f') {
+                *val *= 16;
+                *val += *p - 'a' + 10;
+            } else {
+                return -2;
+            }
+        } else if (radix == 10) {
+            if (*p < '0' || *p > '9') {
+                return -2;
+            }
+            *val *= 10;
+            *val += *p - '0';
+        } else if (radix == 8) {
+            if (*p < '0' || *p > '7') {
+                return -2;
+            }
+            *val *= 8;
+            *val += *p - '0';
+        }
+        p++;
+    }
+    *val = symbol ? -(*val) : *val;
+    return err;
+}
+
+
+
+/* --------------------------------------------------------------------------*/
+/**
+ * @brief  hid keyboard send one key
+ * @param  key - ascii code
+ * @return NULL
+ *
+ * @additional infomation
+ * modifier key bitmap
+ * -  bit0  left control
+ * -  bit1  left shift
+ * -  bit2  left alt
+ * -  bit3  left gui
+ * -  bit4  right control
+ * -  bit5  right shift
+ * -  bit6  right alt
+ * -  bit7  right gui
+ */
+/* --------------------------------------------------------------------------*/
+static void hid_keyboard_send_onekey(u8 key)
+{
+    static u8 last_key = 0;
+    u8 buf[8] = {0};
+    u8 err = 0;
+
+    if (key > sizeof(ascii2kb_remap) / sizeof(ascii2kb_remap[0])) {
+        printf("ERR KEY %x", key);
+        return;
+    }
+
+#if 1
+    if ((ascii2kb_remap[key] & 0xff) == (ascii2kb_remap[last_key] & 0xff)) {
+        buf[0] = (ascii2kb_remap[last_key] & 0x0100) ? 0x02 : 0;
+        if (__this->kb_leds_sta & KB_LED_CAPS_LOCK) {
+            if ((last_key >= 'a' && last_key <= 'z') || (last_key >= 'A' && last_key <= 'Z')) {
+                buf[0] ^= 0x02;
+            }
+        }
+        if ((buf[0] & 0x02) == 0) {
+            buf[0] = 0x00;  //shift key
+            buf[2] = 0x00;
+            hid_write_data(__this->usb_id, buf, 8);
+        }
+    }
+
+    last_key = key;
+    buf[0] = ascii2kb_remap[key] & 0x0100 ? 0x02 : 0x00;  //shift key
+    if (__this->kb_leds_sta & KB_LED_CAPS_LOCK) {
+        if ((key >= 'a' && key <= 'z') || (key >= 'A' && key <= 'Z')) {
+            buf[0] ^= 0x02;
+        }
+    }
+    buf[2] = (u8)(ascii2kb_remap[key] & 0xff);
+    hid_write_data(__this->usb_id, buf, 8);
+    if (buf[2] & 0x02) {
+        buf[0] = 0;
+        buf[2] = 0;
+        hid_write_data(__this->usb_id, buf, 8);
+    }
+#else
+    buf[0] = ascii2kb_remap[key] & 0x0100 ? 0x02 : 0x00;  //shift key
+    if (__this->kb_leds_sta & KB_LED_CAPS_LOCK) {
+        if ((key >= 'a' && key <= 'z') || (key >= 'A' && key <= 'Z')) {
+            buf[0] ^= 0x02;
+        }
+    }
+    buf[2] = (u8)(ascii2kb_remap[key] & 0xff);
+    if ((buf[0] & 0x02) && buf[2] != 0) {
+        u8 tmpbuf[8] = {0x02};
+        hid_write_data(__this->usb_id, tmpbuf, 8);
+    }
+    hid_write_data(__this->usb_id, buf, 8);
+
+    if ((buf[0] & 0x02) && buf[2] != 0) {
+        u8 tmpbuf[8] = {0x02};
+        hid_write_data(__this->usb_id, tmpbuf, 8);
+    }
+    buf[0] = 0x00;  //shift key
+    buf[2] = 0x00;
+    hid_write_data(__this->usb_id, buf, 8);
+#endif
+}
+
+
+
+static void hid_keyboard_send_wc_gbk(u16 wchar)
+{
+    char numeric_str[6] = {0};
+    u8 buf[8] = {0};
+    int err;
+    char *p;
+
+    buf[0] = BIT(2);  //left alt
+    hid_write_data(__this->usb_id, buf, 8);
+    inter2string(wchar, numeric_str, sizeof(numeric_str));
+    p = numeric_str;
+    while (*p != 0) {
+        buf[0] = BIT(2);  //left alt
+        buf[2] = ascii2kp_remap[*p] & 0xff;
+        hid_write_data(__this->usb_id, buf, 8);
+        buf[0] = BIT(2);  //left alt
+        buf[2] = 0;
+        hid_write_data(__this->usb_id, buf, 8);
+        p++;
+    }
+    buf[0] = 0;
+    buf[2] = 0;
+    hid_write_data(__this->usb_id, buf, 8);
+}
+
+int hid_keyboard_send(const u8 *data, u32 len)
+{
+    int i;
+    u32 start_time = jiffies;
+    u16 wchar_gbk;
+    u8 is_tax_code = 0;
+    u32 len2;
+    u8 lf = 0;
+    u8 *ptr = (u8 *)data;
+
+    //ÂõΩÁ®éÊÄªÂ±ÄÂèëÁ•®Âä©Êâã‰∫åÁª¥Á†ÅÊ†ºÂºè
+    if (len > 11 && ptr[0] == '$' && ptr[1] == '0' && ptr[2] == '1') {
+        len2 = len;
+        while (len2 > 11) {
+            if (ptr[len2 - 1] == '$') {
+                is_tax_code = 1;
+                len = len2 - 3; //begin: $01
+                len -= 1;  //end: $
+                ptr += 3;
+                u8 *tmpbuf = zalloc(len);
+                if (!tmpbuf) {
+                    printf("malloc tmpbuf fail\n");
+                    return -1;
+                }
+                // << need function prototype>>
+                //base64_decode(tmpbuf, ptr, len);
+                len -= 4;  //CRC16
+                if (!memcmp(&tmpbuf[len - 3], "</>", 3)) {
+                    len -= 3;  //</>
+                }
+                ptr = tmpbuf;
+                break;
+            } else if (ptr[len2 - 1] == '\n') {
+                lf = 1;
+            }
+            len2--;
+        }
+    }
+
+    if (is_tax_code != 0) {
+        printf("================ is tax qrcode ================\n");
+        i = 0;
+        while (i < len) {
+            if (ptr[i] >= 0x81 && ptr[i] <= 0xfe) {
+                if ((i + 1 < len) && ptr[i + 1] >= 0x40 && ptr[i + 1] <= 0xfe) {
+                    wchar_gbk = (ptr[i] << 8) + ptr[i + 1];
+                    hid_keyboard_send_wc_gbk(wchar_gbk);
+                    i++;
+                }
+                i++;
+            } else if ((i + 2 < len) && !memcmp(&ptr[i], "</>", 3)) {
+                hid_keyboard_send_onekey('\t');
+                i += 3;
+            } else {
+                hid_keyboard_send_onekey(ptr[i]);
+                i++;
+            }
+        }
+        if (lf != 0) {
+            hid_keyboard_send_onekey('\n');
+        }
+    } else {
+        i = 0;
+        while (i < len) {
+            if (ptr[i] < 0x80) {
+                hid_keyboard_send_onekey(ptr[i]);
+                i++;
+            } else {
+                //utf-8 code
+                i += 2;
+            }
+        }
+    }
+    hid_keyboard_send_onekey(0);
+
+    /* printf("usb send ptr %3d[in %d ms]: %s\n", len, jiffies_to_msecs(jiffies - start_time), ptr); */
+
+    if (ptr != data) {
+        free(ptr);
+    }
+    return 0;
+}
+
+
+//usbÁõ∏ÂÖ≥
+int hid_keyboard_output(u8 *buf, u32 len)
+{
+    puts("hid output report\n");
+    put_buf(buf, len);
+    __this->kb_leds_sta = buf[0];
+    return len;
+}
+
+void hid_keyboard_set_usb_dev(usb_dev usb_id)
+{
+    __this->usb_id = usb_id;
+}
+
+#endif
+
+
Index: include/app_config.h
===================================================================
--- include/app_config.h	(revision 1020)
+++ include/app_config.h	(working copy)
@@ -17,8 +17,85 @@
 #endif
 #define CONFIG_DEBUG_LIB(x)         (x & LIB_DEBUG)
 
+
+#define TCFG_SD0_ENABLE  1
+#define TCFG_PC_ENABLE  0
+#define USB_PC_NO_APP_MODE                  2
+#define USB_DEVICE_CLASS_CONFIG    (HID_CLASS)
+
+#define FAT_CACHE_NUM 32
+#define TCFG_UDISK_ENABLE                   1
+
+
+
+#if TCFG_SD0_ENABLE
+#define CONFIG_STORAGE_PATH 	"storage/sd0"
+#define SDX_DEV					"sd0"
+#endif
+
+#if TCFG_SD1_ENABLE
+#define CONFIG_STORAGE_PATH 	"storage/sd1"
+#define SDX_DEV					"sd1"
+#endif
+
+
+#define CONFIG_UDISK_STORAGE_PATH	"storage/usb_disk"
+#define CONFIG_UDISK_ROOT_PATH     	CONFIG_UDISK_STORAGE_PATH"/C/"
+
+
+#if (TCFG_SD0_ENABLE || TCFG_SD1_ENABLE)
+
+#define TCFG_SD_PORTS                      'D'			//SD0/SD1ÁöÑABCDÁªÑ
+#define TCFG_SD_DAT_WIDTH                  1			//1:ÂçïÁ∫øÊ®°Âºè, 4:ÂõõÁ∫øÊ®°Âºè
+#define TCFG_SD_DET_MODE                   SD_CMD_DECT	//Ê£ÄÊµãÊ®°Âºè
+#define TCFG_SD_DET_IO                     IO_PORTA_01	//SD_DET_MODE‰∏∫SD_IO_DECTÊó∂ÊúâÊïà
+#define TCFG_SD_DET_IO_LEVEL               0			//IOÊ£ÄÂç°‰∏äÁ∫øÁöÑÁîµÂπ≥(0/1),SD_DET_MODE‰∏∫SD_IO_DECTÊó∂ÊúâÊïà
+#define TCFG_SD_CLK                        24000000		//SDÊó∂Èíü
+
+#endif
+
+#define CONFIG_AUDIO_ENABLE
+#define CONFIG_PCM_ENC_ENABLE
+#define CONFIG_PCM_DEC_ENABLE
+
+
+#define AUDIO_ENC_SAMPLE_SOURCE_MIC         0
+#define AUDIO_ENC_SAMPLE_SOURCE_PLNK0       1
+#define AUDIO_ENC_SAMPLE_SOURCE_PLNK1       2
+#define AUDIO_ENC_SAMPLE_SOURCE_IIS0        3
+#define AUDIO_ENC_SAMPLE_SOURCE_IIS1        4
+
+
+
+#define CONFIG_AUDIO_ENC_SAMPLE_SOURCE      AUDIO_ENC_SAMPLE_SOURCE_MIC
+
+
+
+
+#define CONFIG_VIDEO_ENABLE
+//#define CONFIG_OSD_ENABLE						/* ËßÜÈ¢ëÊó∂Èó¥OSD */
+#define CONFIG_VIDEO_REC_PPBUF_MODE
 
+#define RTOS_STACK_CHECK_ENABLE //ÊòØÂê¶ÂêØÁî®ÂÆöÊó∂Ê£ÄÊü•‰ªªÂä°Ê†à
 
+#define CONFIG_USR_VIDEO_ENABLE		//Áî®Êà∑VIDEO‰ΩøËÉΩ
+#define USR_PATH "192.168.1.1:8000" //Áî®Êà∑Ë∑ØÂæÑÔºåÂèØÈöèÊÑèËÆæÁΩÆÔºåvideo_rt_usr.cÁöÑinitÂáΩÊï∞ÁúãËøõË°åËØªÂèñ
 
+//Èü≥È¢ëÈááÊ†∑Áéá,Ê≥®ÊÑèÔºöÁ°¨‰ª∂Ê≤°ÊúâÊé•Âí™Â§¥ÈúÄË¶ÅËÆæÁΩÆ‰∏∫0
+#define USER_VIDEO_REC_AUDIO_SAMPLE_RATE    8000
+
+//ÊëÑÂÉèÂ§¥Â∞∫ÂØ∏ÔºåÊ≠§Â§ÑÈúÄË¶ÅÂíåÊëÑÂÉèÂ§¥È©±Âä®ÂåπÈÖç
+#define CONFIG_USER_VIDEO_WIDTH		640
+#define CONFIG_USER_VIDEO_HEIGHT	480
+
+
+
+#include "usb_std_class_def.h"
+#include "usb_common_def.h"
+
+#define USB_HID_KEYBOARD_ENABLE   1
+#define USB_HID_POS_ENABLE        0
+
+
 #endif
 
Index: include/cpu_config.h
===================================================================
--- include/cpu_config.h	(nonexistent)
+++ include/cpu_config.h	(working copy)
@@ -0,0 +1,61 @@
+#ifndef CPU_CONFIG_H
+#define CPU_CONFIG_H
+
+#define FAT_CACHE_NUM   32
+
+#define VIDEO0_REC_FORMAT   VIDEO_FMT_AVI
+#define VIDEO1_REC_FORMAT   VIDEO_FMT_AVI
+#define VIDEO2_REC_FORMAT   VIDEO_FMT_AVI
+#ifdef CONFIG_PSRAM_ENABLE
+#define VREC0_FBUF_SIZE     (512*1024)
+#define VREC1_FBUF_SIZE     (256*1024)
+#define VREC2_FBUF_SIZE     (256 * 1024)
+#define AUDIO_BUF_SIZE      (256*1024)
+#else
+#if (!defined CONFIG_NO_SDRAM_ENABLE && __SDRAM_SIZE__ >= (2 * 1024 * 1024))
+#define VREC0_FBUF_SIZE     (500*1024)
+#define VREC1_FBUF_SIZE     (0)
+#define VREC2_FBUF_SIZE     (0)
+#define AUDIO_BUF_SIZE      (64*1024)
+#else
+#define VREC0_FBUF_SIZE     (150*1024)
+#define VREC1_FBUF_SIZE     (0)
+#define VREC2_FBUF_SIZE     (0)
+#define AUDIO_BUF_SIZE      (16*1024)
+#endif
+#endif
+
+#define USB_CAMERA_BUF_SIZE (1 * 1024 * 1024) // + 512 * 1024)
+#define CAMERA_CAP_BUF_SIZE (1 * 1024 * 1024)
+
+
+#if (!defined CONFIG_NO_SDRAM_ENABLE && __SDRAM_SIZE__ >= (2 * 1024 * 1024))
+#define NET_VREC0_FBUF_SIZE     (200*1024)
+#define NET_VREC1_FBUF_SIZE     (0)
+#define NET_AUDIO_BUF_SIZE      (64*1024)
+
+#define USER_VREC0_FBUF_SIZE     (200*1024)
+#define USER_AUDIO_BUF_SIZE      (64*1024)
+#else
+#define NET_VREC0_FBUF_SIZE     (100*1024)
+#define NET_VREC1_FBUF_SIZE     (0)
+#define NET_AUDIO_BUF_SIZE      (16*1024)
+
+#define USER_VREC0_FBUF_SIZE     (100*1024)
+#define USER_AUDIO_BUF_SIZE      (16*1024)
+#endif
+
+
+#ifndef CONFIG_VIDEO1_ENABLE
+#undef VREC1_FBUF_SIZE
+#define VREC1_FBUF_SIZE (0)
+#endif
+
+#ifndef CONFIG_VIDEO2_ENABLE
+#undef VREC2_FBUF_SIZE
+#define VREC2_FBUF_SIZE (0)
+#endif
+
+
+
+#endif
Index: include/net_config.h
===================================================================
--- include/net_config.h	(nonexistent)
+++ include/net_config.h	(working copy)
@@ -0,0 +1,99 @@
+#ifndef _NET_CONFIG_H__
+#define _NET_CONFIG_H__
+#include "app_config.h"
+
+
+/*------------ÁΩëÁªúÈÖçÁΩÆ----------*/
+#define ACCESS_NUM 				1
+#define UUID 					"f2dd3cd7-b026-40aa-aaf4-"
+#define WIFI_CAM_NAME_MATCH 	"wifi_camera_"
+#define WIFI_CAM_WIFI_PWD    	"12345678"
+//#define CONFIG_ENABLE_VLIST
+
+#define WIFI_CAM_PREFIX    "wifi_camera_wl80_"
+//#define CONFIG_FORCE_RESET_VM  //Ê™´Èô§vmÊâÄÊúâÈÖçÁΩÆ
+
+/*-----------ÁºñÁ†ÅÂíåÁΩëÁªúÂåÖÈÖçÁΩÆ----------*/
+#define CONFIG_NET_JPEG
+/*-----------ÁºñÁ†ÅÂõæÁâáÂàÜËæ®Áéá----------*/
+//#define CONFIG_NET_VIDEO_720P
+
+#ifdef CONFIG_NET_VIDEO_720P
+#define CONFIG_NET_VIDEO_IMAGE_W    1280
+#define CONFIG_NET_VIDEO_IMAGE_H    720
+#else
+#define CONFIG_NET_VIDEO_IMAGE_W    640
+#define CONFIG_NET_VIDEO_IMAGE_H    480
+#endif
+
+//#define CONFIG_NET_TCP_ENABLE
+#define CONFIG_NET_UDP_ENABLE
+//#define CONFIG_NET_USR_ENABLE
+
+#ifdef CONFIG_NET_JPEG
+#define CONFIG_NET_PKG_JPEG
+#endif
+
+#ifdef CONFIG_NET_USR_ENABLE
+#define NET_USR_PATH 		"192.168.1.1:8000"//ÈúÄË¶ÅÊâìÂºÄCONFIG_NET_UDP_ENABLEÔºåÂÖ≥Èó≠CONFIG_NET_TCP_ENABLEÂíåCONFIG_NET_UDP_ENABLE ÊúâÊïà
+#endif
+
+//#define CONFIG_NET_SCR  /*ÁΩëÁªúÊäïÂ±è*/
+//#define CONFIG_EG_HTTP_SERVER /*enable eg_http_server*/
+// #define CONFIG_EG_HTTP_CLIENT /*enable_eg_http_client only test*/
+
+/*-------------ÁΩëÁªúÁ´ØÂè£----------------*/
+#define CTP_CTRL_PORT   	3333
+#define CDP_CTRL_PORT   	2228
+#define NET_SCR_PORT    	2230
+#define VIDEO_PREVIEW_PORT 	2226
+#define VIDEO_PLAYBACK_PORT 2223
+#define HTTP_PORT           8080
+#define RTSP_PORT           554
+
+/*--------ËßÜÈ¢ëÂ∫ìÂÜÖ‰ΩøÁî®----------------*/
+#define _DUMP_PORT          2229
+#define _FORWARD_PORT    	2224
+#define _BEHIND_PORT     	2225
+
+
+/*------------ RFÊ®°ÂùóÈÖçÁΩÆ-------------*/
+// #define CONFIG_RTC676X_ENABLE
+// #define CONFIG_A7130_ENABLE
+//#define CONFIG_P2418_ENABLE
+// #define CONFIG_A7196_ENABLE
+
+
+/*--------ÂΩïÂÉèÂíåÂÆûÊó∂ÊµÅÂ∏ßÁéáÈÖçÁΩÆ--------*/
+//ÂΩïÂç°ÂíåÂÆûÊó∂ÊµÅÁöÑÈü≥È¢ëÈááÊ†∑Áéá,Ê≥®ÊÑèÔºöÁ°¨‰ª∂Ê≤°ÊúâÊé•Âí™Â§¥ÈúÄË¶ÅËÆæÁΩÆ‰∏∫0
+#define VIDEO_REC_AUDIO_SAMPLE_RATE		8000
+
+//ÂΩïÂç°ÂâçÂêéËßÜÂ∏ßÁéáËÆæÁΩÆ
+#define  LOCAL_VIDEO_REC_FPS 			20  //‰∏ç‰ΩøÁî®0‰Ωú‰∏∫ÈªòËÆ§ÂÄºÔºåÂÜôÂÖ∑‰ΩìÊï∞ÂÄº
+
+//ÂÆûÊó∂ÊµÅBUFFÂÖÅËÆ∏ÁºìÂ≠òÂ∏ßÊï∞(Âª∂Êó∂Â§ßÂàôÈúÄË¶ÅÊâìÂºÄÔºå‰æãÂ¶ÇÂΩïÂÉè‰∏≠720P),ÂÜô0Êó†Êïà,Ê≥®ÊÑèÔºöËØ•ÂÆèÂ§ß‰∫é1Êó∂Ôºå‰ºöÂºïËµ∑ÂÆûÊó∂ÊµÅÂÆûÈôÖÂ∏ßÁéáÊØîÈÖçÁΩÆ‰ΩéÔºå‰ΩÜÊòØÂÆûÊó∂ÊÄßÂ•Ω
+#define  NET_VIDEO_BUFF_FRAME_CNT		2
+
+//ÂÆûÊó∂ÊµÅÂâçÂêéËßÜÂ∏ßÁéáËÆæÁΩÆ
+#define  NET_VIDEO_REC_FPS0   			20  //‰∏ç‰ΩøÁî®0‰Ωú‰∏∫ÈªòËÆ§ÂÄºÔºåÂÜôÂÖ∑‰ΩìÊï∞ÂÄº
+#define  NET_VIDEO_REC_FPS1   			20   //‰∏ç‰ΩøÁî®0‰Ωú‰∏∫ÈªòËÆ§ÂÄºÔºåÂÜôÂÖ∑‰ΩìÊï∞ÂÄº
+
+//ÂΩïÂÉèÊ®°ÂºèÂÆûÊó∂ÊµÅ‰∏¢Â∏ßÈÖçÁΩÆ(ÂçïË∑Ø720ÂΩïÂÉè‰∏îÂÆûÊó∂ÊµÅ720ÊàñÂèåË∑ØÂΩïÂÉèÊúâÊïà),Âè™ËÉΩÈÖçÁΩÆ‰ª•‰∏ã3‰∏™ÂÆèÊï∞ÂÄº>=1ÂÖ∂‰∏≠‰∏Ä‰∏™,ÈÖçÁΩÆÂøÖÈ°ªÂ∞è‰∫éÁ≠â‰∫éÊëÑÂÉèÂ§¥ËæìÂá∫Â∏ßÁéá,ÂÖ®0ÂàôËæìÂá∫ÂΩïÂÉèÂ∏ßÁéá
+#define  NET_VIDEO_REC_DROP_REAl_FP		15	//(ÂÆûÈôÖËæìÂá∫Â∏ßÁéáÔºåÂçïË∑Ø720ÂΩïÂÉè‰∏îÂÆûÊó∂ÊµÅ720ÊàñÂèåË∑ØÂΩïÂÉèÊúâÊïà,ÂÜô0Êó†Êïà,‰∏çÂΩïÂÉèËØ∑Áî®NET_VIDEO_REC_FPS0,NET_VIDEO_REC_FPS1)
+#define  NET_VIDEO_REC_LOSE_FRAME_CNT	0	//(ÊØèÈöînÂ∏ß‰∏¢‰∏ÄÂ∏ß,ÂçïË∑Ø720ÂΩïÂÉè‰∏îÂÆûÊó∂ÊµÅ720ÊàñÂèåË∑ØÂΩïÂÉèÊúâÊïà,ÂÜô0Êó†Êïà)30pÊëÑÂÉèÂ§¥,ÈúÄÊ±Ç>=15p/sÂàôÈÖçÁΩÆ>=1;25pÊëÑÂÉèÂ§¥,ÈúÄÊ±Ç>=12p/sÂàôÈÖçÁΩÆ>=1.
+#define  NET_VIDEO_REC_SEND_FRAME_CNT	0	//(ÊØèÈöînÂ∏ßÂèë‰∏ÄÂ∏ß,ÂçïË∑Ø720ÂΩïÂÉè‰∏îÂÆûÊó∂ÊµÅ720ÊàñÂèåË∑ØÂΩïÂÉèÊúâÊïà,ÂÜô0Êó†Êïà)
+
+//RTSPÂÆûÊó∂ÊµÅÂ∏ßÁéáËÆæÁΩÆ
+#define  STRM_VIDEO_REC_FPS0   			5  //‰∏ç‰ΩøÁî®0‰Ωú‰∏∫ÈªòËÆ§ÂÄºÔºåÂÜôÂÖ∑‰ΩìÊï∞ÂÄº
+#define  STRM_VIDEO_REC_DROP_REAl_FP 	5  //(ÂÆûÈôÖËæìÂá∫Â∏ßÁéáÔºåÂçïË∑Ø720ÂΩïÂÉè‰∏îÂÆûÊó∂ÊµÅ720ÊàñÂèåË∑ØÂΩïÂÉèÊúâÊïà,ÂÜô0Êó†Êïà)
+
+//RTSPÂÆûÊó∂ÊµÅBUFFÂÖÅËÆ∏ÁºìÂ≠òÂ∏ßÊï∞(Âª∂Êó∂Â§ßÂàôÈúÄË¶ÅÊâìÂºÄÔºå‰æãÂ¶ÇÂΩïÂÉè‰∏≠720P),ÂÜô0Êó†Êïà,Ê≥®ÊÑèÔºöËØ•ÂÆèÂ§ß‰∫é1Êó∂Ôºå‰ºöÂºïËµ∑ÂÆûÊó∂ÊµÅÂÆûÈôÖÂ∏ßÁéáÊØîÈÖçÁΩÆ‰ΩéÔºå‰ΩÜÊòØÂÆûÊó∂ÊÄßÂ•Ω
+#define  STRM_VIDEO_BUFF_FRAME_CNT		2
+/*--------------------------------------*/
+
+
+
+
+
+#endif
+
Index: include/stream_protocol.h
===================================================================
--- include/stream_protocol.h	(nonexistent)
+++ include/stream_protocol.h	(working copy)
@@ -0,0 +1,10 @@
+#ifndef __STRM_PTL_H_
+#define __STRM_PTL_H_
+
+
+int stream_protocol_task_create(char *path, char *mode);
+int stream_protocol_task_kill(void);
+int stream_packet_cb(u8 type, u8 *buf, u32 size);
+
+#endif
+
Index: stream_protocol.c
===================================================================
--- stream_protocol.c	(nonexistent)
+++ stream_protocol.c	(working copy)
@@ -0,0 +1,280 @@
+#include "sys_common.h"
+#include "system/spinlock.h"
+#include "os/os_api.h"
+#include "app_config.h"
+#include "os/os_api.h"
+#include "stream_core.h"
+#include "asm/uart.h"
+#include "server/video_server.h"
+#include "rt_stream_pkg.h"
+#include "cpu_config.h"
+
+#ifdef CONFIG_USR_VIDEO_ENABLE
+#define VIDEO_PKBUFF_SIZE 	(USER_VREC0_FBUF_SIZE / 2)
+#else
+#define VIDEO_PKBUFF_SIZE 	(NET_VREC0_FBUF_SIZE / 2)
+#endif
+
+#if USER_VIDEO_REC_AUDIO_SAMPLE_RATE
+#if USER_AUDIO_BUF_SIZE
+#define AUDIO_PKBUFF_SIZE 	(USER_AUDIO_BUF_SIZE / 2)
+#endif
+#endif
+
+#define jl_ntohl(x) (u32)((((u32)(x))>>24) | ((((u32)(x))>>8)&0xff00) | (((u32)(x))<<24) | ((((u32)(x))&0xff00)<<8))
+
+#define JL_ENDF     	jl_ntohl(0x56185719)
+#define JPEG_HEAD 		0xE0FFD8FF
+#define JL_000DC		jl_ntohl(0x30306463)
+#define JL_001WB		jl_ntohl(0x30317762)
+
+
+struct strm_path {
+    char *path;
+    char *mode;
+};
+
+struct strm_ptl_info {
+    u8 kill: 1;
+    u8 vd_use: 1;
+    u8 ad_use: 1;
+    u8 err: 1;
+    u8 init: 1;
+    u8 copy: 1;
+    struct strm_path spath;
+    void *ptl_fd;
+    OS_SEM sem;
+    u8 *video_pkbuff;
+    u8 *audio_pkbuff;
+    u32 vd_len;
+    u32 ad_len;
+    int pid;
+};
+struct strm_ptl_info strm_ptl_info_ = {0};
+#define strm_ptl (&strm_ptl_info_)
+
+
+/*********************************************************************************/
+static int stream_protocol_open(const char *path, const char *mode)
+{
+    strm_ptl->ptl_fd = stream_open(path, mode);
+    if (!strm_ptl->ptl_fd) {
+        printf("stream_protocol_open err !!!\n");
+        return -1;
+    }
+    return 0;
+}
+
+static int stream_protocol_write(u8 type, void *buf, u32 len)
+{
+    u32 *len_ptr = (u32 *)buf;
+    if (!strm_ptl->ptl_fd) {
+        return 0;
+    } else if (len <= 8) {
+        return len;
+    }
+    if (*(len_ptr + 2) == JPEG_HEAD) {
+        buf += 8;
+        len -= 8;
+    }
+    len &= ~(0xf << 28);
+    len |= type << 28;
+    return stream_write(strm_ptl->ptl_fd, buf, len);
+}
+
+static int stream_protocol_ctrl(u32 cmd, u32 arg)
+{
+    if (!strm_ptl->ptl_fd) {
+        return 0;
+    }
+    return stream_ctrl(strm_ptl->ptl_fd, cmd, arg);
+}
+
+static int stream_protocol_close(void)
+{
+    int ret;
+    if (!strm_ptl->ptl_fd) {
+        return 0;
+    }
+    ret = stream_close(strm_ptl->ptl_fd);
+    strm_ptl->ptl_fd = NULL;
+    return ret;
+}
+/*********************************************************************************/
+
+int stream_packet_cb(u8 type, u8 *buf, u32 size)
+{
+    u32 *head = (u32 *)buf;
+    if (!strm_ptl->init || strm_ptl->err || strm_ptl->kill) {
+        return 0;
+    } else if ((size <= 8) && (*head == JL_ENDF)) {
+        return size;
+    }
+
+    if (type == VIDEO_REC_JPEG_TYPE_VIDEO) {
+        if (size > VIDEO_PKBUFF_SIZE) {
+            printf("VDPKBUFF_SIZE no enough !!!\n");
+            return 0;
+        }
+        if ((*head == JL_000DC && *(head + 2) == JPEG_HEAD) || *(head + 2) == JPEG_HEAD) {
+            buf += 8;
+            size -= 8;
+        }
+        if (!strm_ptl->vd_use && !strm_ptl->kill) {
+            strm_ptl->copy = true;
+            strm_ptl->vd_use = true;
+            strm_ptl->vd_len = size;
+            memcpy(strm_ptl->video_pkbuff, buf, size);
+            strm_ptl->copy = false;
+            os_sem_post(&strm_ptl->sem);
+        }
+    } else if (type == VIDEO_REC_PCM_TYPE_AUDIO) {
+#ifdef AUDIO_PKBUFF_SIZE
+        if (size > AUDIO_PKBUFF_SIZE) {
+            printf("ADPKBUFF_SIZE no enough !!!\n");
+            return 0;
+        }
+        if (!strm_ptl->ad_use && !strm_ptl->kill) {
+            strm_ptl->copy = true;
+            strm_ptl->ad_use = true;
+            strm_ptl->ad_len = size;
+            memcpy(strm_ptl->audio_pkbuff, buf, size);
+            strm_ptl->copy = false;
+            os_sem_post(&strm_ptl->sem);
+        }
+#endif
+    }
+    return size;
+}
+
+static int stream_protocol_task(void *p)
+{
+    int ret;
+    int to = 20;
+
+    os_sem_create(&strm_ptl->sem, 0);
+    strm_ptl->video_pkbuff = malloc(VIDEO_PKBUFF_SIZE);
+    if (!strm_ptl->video_pkbuff) {
+        printf("err : no mem for vd pkbuff !!!\n");
+        strm_ptl->err = true;
+        goto exit;
+    }
+#ifdef AUDIO_PKBUFF_SIZE
+    strm_ptl->audio_pkbuff = malloc(AUDIO_PKBUFF_SIZE);
+    if (!strm_ptl->audio_pkbuff) {
+        printf("err : no mem for ad pkbuff !!!\n");
+        strm_ptl->err = true;
+        goto exit;
+    }
+#endif
+
+    ret = stream_protocol_open(strm_ptl->spath.path, strm_ptl->spath.mode);
+    if (ret) {
+        printf("stream_protocol_open err, path : %s \n", strm_ptl->spath.path);
+        strm_ptl->err = true;
+        goto exit;
+    }
+    strm_ptl->init = true;
+    printf("stream_protocol run \n");
+    while (1) {
+        ret = os_sem_pend(&strm_ptl->sem, 10);
+        if (strm_ptl->kill) {
+            break;
+        }
+        if (!ret) {
+            if (strm_ptl->vd_use && strm_ptl->ad_use) {
+                os_sem_set(&strm_ptl->sem, 0);
+            }
+            if (strm_ptl->vd_use) {
+                ret = stream_protocol_write(JPEG_TYPE_VIDEO, strm_ptl->video_pkbuff, strm_ptl->vd_len);
+                strm_ptl->vd_use = false;
+                if (!ret) {
+                    strm_ptl->err = true;
+                    printf("err : stream_protocol_write, kill task !!!\n");
+                    break;
+                }
+            }
+#ifdef AUDIO_PKBUFF_SIZE
+            if (strm_ptl->ad_use) {
+                ret = stream_protocol_write(PCM_TYPE_AUDIO, strm_ptl->audio_pkbuff, strm_ptl->ad_len);
+                strm_ptl->ad_use = false;
+                if (!ret) {
+                    strm_ptl->err = true;
+                    printf("err : stream_protocol_write, kill task !!!\n");
+                    break;
+                }
+            }
+#endif
+        }
+    }
+
+exit:
+    strm_ptl->kill = true;
+    while (strm_ptl->copy && to--) {
+        os_time_dly(1);
+    }
+    stream_protocol_close();
+    if (strm_ptl->video_pkbuff) {
+        free(strm_ptl->video_pkbuff);
+        strm_ptl->video_pkbuff = NULL;
+    }
+    if (strm_ptl->audio_pkbuff) {
+        free(strm_ptl->audio_pkbuff);
+        strm_ptl->audio_pkbuff = NULL;
+    }
+    if (os_sem_valid(&strm_ptl->sem)) {
+        os_sem_del(&strm_ptl->sem, 0);
+    }
+    return 0;
+}
+int stream_protocol_task_create(char *path, char *mode)
+{
+    int ret;
+    int to = 100;
+    if (strm_ptl->init) {
+        printf("stream_protocol_task already open \n");
+        return 0;
+    }
+
+    strm_ptl->spath.path = path;
+    strm_ptl->spath.mode = mode;
+    strm_ptl->ptl_fd = NULL;
+    strm_ptl->kill = 0;
+    strm_ptl->err = 0;
+    strm_ptl->vd_use = 0;
+    strm_ptl->ad_use = 0;
+    strm_ptl->pid = 0;
+    ret = thread_fork("stream_protocol_task", 16, 1024, 0, &strm_ptl->pid, stream_protocol_task, NULL);
+    if (ret) {
+        printf("stream_protocol_task create err !!!\n");
+        return -1;
+    }
+    while (!strm_ptl->init && !strm_ptl->err && --to) {
+        os_time_dly(1);
+    }
+    if (strm_ptl->err || to == 0) {
+        ret = -EINVAL;
+    }
+    if (ret) {
+        printf("stream_protocol_task kill req = %d\n", ret);
+        strm_ptl->kill = true;
+        os_sem_post(&strm_ptl->sem);
+        thread_kill(&strm_ptl->pid, KILL_WAIT);
+        strm_ptl->init = false;
+        strm_ptl->kill = false;
+    }
+    return ret;
+}
+int stream_protocol_task_kill(void)
+{
+    if (strm_ptl->init) {
+        strm_ptl->kill = true;
+        os_sem_post(&strm_ptl->sem);
+        printf("stream_protocol task kill \n");
+        thread_kill(&strm_ptl->pid, KILL_WAIT);
+        strm_ptl->init = false;
+        strm_ptl->kill = false;
+    }
+    return 0;
+}
+
Index: user_video_rec.c
===================================================================
--- user_video_rec.c	(nonexistent)
+++ user_video_rec.c	(working copy)
@@ -0,0 +1,272 @@
+#include "system/includes.h"
+#include "server/video_server.h"
+#include "app_config.h"
+#include "asm/debug.h"
+#include "asm/osd.h"
+#include "asm/isc.h"
+#include "os/os_api.h"
+#include "camera.h"
+#include "cpu_config.h"
+#include "stream_protocol.h"
+#include "rt_stream_pkg.h"
+
+/***********************************USER VIDEO*******************************************
+ 1„ÄÅË∞ÉÁî®user_video_rec0_open,ÊâìÂºÄÊëÑÂÉèÂ§¥ÊàêÂäüÂêéÔºå‰ºöÂõûË∞ÉÂà∞video_rt_usr_init
+ 2„ÄÅÊï∞ÊçÆÂõûË∞ÉÔºöuser_video_frame_callbackÂáΩÊï∞
+    Ê≥®ÊÑèÔºöËØ•ÂáΩÊï∞‰∏çËÉΩËøõË°åÂª∂Êó∂Â§™ÈïøÊìç‰ΩúÔºåÂê¶Âàô‰∏¢Â∏ßÔºåÊï∞ÊçÆÂõûË∞ÉÁî®Âú®ÂèëÈÄÅÊï∞ÊçÆÊàñËÄÖÊã∑Ë¥ùÊï∞ÊçÆ
+ 3„ÄÅË∞ÉÁî®user_video_rec0_closeÂÖ≥Èó≠ÊëÑÂÉèÂ§¥
+****************************************************************************************/
+
+
+#ifdef CONFIG_USR_VIDEO_ENABLE
+
+struct user_video_hdl {
+    u8 state;
+    u8 page_turning;
+    u8 req_send;
+    u8 *user_isc_buf;
+    u8 *user_video_buf;
+    u8 *user_audio_buf;
+    struct server *user_video_rec;
+};
+
+static struct user_video_hdl user_handler = {0};
+#define __this_user  (&user_handler)
+
+#define USER_ISC_SBUF_SIZE     		(CONFIG_USER_VIDEO_WIDTH*32*3/2)
+#define USER_VIDEO_SBUF_SIZE   		USER_VREC0_FBUF_SIZE
+
+#define USER_ISC_STATIC_BUFF_ENABLE		1	//1‰ΩøÁî®ÈùôÊÄÅÂÜÖÈÉ®ram
+
+#if USER_ISC_STATIC_BUFF_ENABLE
+static u8 user_isc_sbuf[USER_ISC_SBUF_SIZE] SEC_USED(.sram) ALIGNE(32);//ÂøÖÈ°ª32ÂØπÈΩê
+#endif
+#endif
+
+#ifdef CONFIG_OSD_ENABLE
+static const unsigned char user_osd_format_buf[] = "yyyy-nn-dd hh:mm:ss";//Êó∂Èó¥OSD
+#endif
+
+void set_video_rt_cb(u32(*cb)(void *buf, u32 len, u8 type));
+
+/*
+ *Á†ÅÁéáÊéßÂà∂ÔºåÊ†πÊçÆÂÖ∑‰ΩìÂàÜËæ®ÁéáËÆæÁΩÆ:1000 - 6000
+ */
+int user_video_rec_get_abr(u32 width)
+{
+    if (width <= 640) {
+        return 2800;
+    } else {
+        return 2000;
+    }
+}
+/*
+ *Èü≥ËßÜÈ¢ëÊï∞ÊçÆÂõûË∞É
+ */
+u32 user_video_frame_callback(void *data, u32 len, u8 type)
+{
+    if (type == JPEG_TYPE_VIDEO) { //jpegËßÜÈ¢ë
+        putchar('V');
+        /*put_buf(data, len);*/
+    } else if (type == PCM_TYPE_AUDIO) { //PCMÈü≥È¢ë
+        putchar('A');
+        /*put_buf(data, len);*/
+    }
+    return 0;
+}
+/*
+ *Áî®Êà∑VIDEOÊâìÂºÄ
+ */
+int user_video_rec0_open(void)
+{
+    int err = 0;
+#ifdef CONFIG_USR_VIDEO_ENABLE
+    union video_req req = {0};
+    char path[48];
+
+    if (__this_user->state) {
+        printf("user already open \n");
+        return 0;
+    }
+    if (!__this_user->user_video_buf) {
+        __this_user->user_video_buf = malloc(USER_VIDEO_SBUF_SIZE);
+        if (!__this_user->user_video_buf) {
+            puts("no mem \n");
+            return -1;
+        }
+    }
+    if (!__this_user->user_audio_buf && USER_VIDEO_REC_AUDIO_SAMPLE_RATE) {
+        __this_user->user_audio_buf = malloc(USER_AUDIO_BUF_SIZE);
+        if (!__this_user->user_audio_buf) {
+            puts("no mem \n");
+            return -1;
+        }
+    }
+#if USER_ISC_STATIC_BUFF_ENABLE
+    __this_user->user_isc_buf = user_isc_sbuf;
+#else
+    if (!__this_user->user_isc_buf) {
+        __this_user->user_isc_buf = malloc(USER_ISC_SBUF_SIZE);
+        if (!__this_user->user_isc_buf) {
+            puts("no mem \n");
+            goto __exit;
+        }
+    }
+#endif
+
+    if (!__this_user->user_video_rec) {
+        __this_user->user_video_rec = server_open("video_server", "video0.1");
+        if (!__this_user->user_video_rec) {
+            goto __exit;
+        }
+    }
+
+#ifdef CONFIG_VIDEO_REC_PPBUF_MODE
+    req.rec.bfmode = VIDEO_PPBUF_MODE;
+#endif
+#ifdef  CONFIG_VIDEO_SPEC_DOUBLE_REC_MODE
+    req.rec.wl80_spec_mode = VIDEO_WL80_SPEC_DOUBLE_REC_MODE;
+#endif
+    req.rec.picture_mode = 0;//ÈùûÁªòÊú¨Ê®°Âºè
+    req.rec.isc_sbuf = __this_user->user_isc_buf;
+    req.rec.sbuf_size = USER_ISC_SBUF_SIZE;
+    req.rec.camera_type = VIDEO_CAMERA_NORMAL;
+    req.rec.channel = 1;
+    req.rec.width 	= CONFIG_USER_VIDEO_WIDTH;
+    req.rec.height 	= CONFIG_USER_VIDEO_HEIGHT;
+    req.rec.state 	= VIDEO_STATE_START;
+    req.rec.fpath 	= NULL;
+    req.rec.format 	= USER_VIDEO_FMT_AVI;
+    req.rec.fname    = "vid_***.avi";
+    req.rec.quality = VIDEO_LOW_Q;//VIDEO_MID_Q;
+    req.rec.fps = 0;
+    req.rec.real_fps = 15;//Â∏ßÁéá
+
+    //ÈúÄË¶ÅÈü≥È¢ëÔºöËØ∑ÂÜôaudio.sample_rateÂíåaudio.buf„ÄÅaudio.buf_len
+    req.rec.audio.sample_rate = USER_VIDEO_REC_AUDIO_SAMPLE_RATE;//8000 Èü≥È¢ëÈááÊ†∑Áéá
+    req.rec.audio.channel = 1;//ÈÄâÊã©Á°¨‰ª∂1‰∏™MICÊï∞
+    req.rec.audio.channel_bit_map = 0;//ÈÄâÊã©Á¨¨Âá†‰∏™MICÔºå0ÂàôÊòØÁâàÁ±çÈÖçÁΩÆÊñá‰ª∂ÈªòËÆ§,//LADC_CH_MIC1_P_N
+    req.rec.audio.volume = 100;//Èü≥È¢ëÂ¢ûÁõä0-100
+    req.rec.audio.buf = __this_user->user_audio_buf;//Èü≥È¢ëBUFF
+    req.rec.audio.buf_len = USER_AUDIO_BUF_SIZE;//Èü≥È¢ëBUFFÈïøÂ∫¶
+
+    req.rec.pkg_mute.aud_mute = 0;
+    req.rec.abr_kbps = user_video_rec_get_abr(req.rec.width);//JPEGÂõæÁâáÁ†ÅÁéá
+    req.rec.IP_interval = 0;
+    req.rec.buf = __this_user->user_video_buf;
+    req.rec.buf_len = USER_VIDEO_SBUF_SIZE;
+    req.rec.block_done_cb = 0;
+
+#ifdef CONFIG_OSD_ENABLE
+    struct video_text_osd text_osd = {0};
+    text_osd.font_w = OSD_DEFAULT_WIDTH;//ÂøÖÈ°ª16ÂØπÈΩê
+    text_osd.font_h = OSD_DEFAULT_HEIGHT;//ÂøÖÈ°ª16ÂØπÈΩê
+    text_osd.text_format = user_osd_format_buf;
+    text_osd.x = (req.rec.width - text_osd.font_w * strlen(text_osd.text_format) + 15) / 16 * 16;
+    text_osd.y = (req.rec.height - text_osd.font_h + 15) / 16 * 16;
+    text_osd.osd_yuv = 0xe20095;
+    text_osd.font_matrix_table = NULL;
+    text_osd.font_matrix_base = NULL;
+    text_osd.font_matrix_len = 0;
+    req.rec.text_osd = &text_osd;
+#endif
+
+#ifdef CONFIG_USR_VIDEO_ENABLE
+    sprintf(path, "usr://%s", USR_PATH);
+#else
+    sprintf(path, "usr://%s", "192.168.1.1");
+#endif
+    strcpy(req.rec.net_par.netpath, path);
+
+    err = server_request(__this_user->user_video_rec, VIDEO_REQ_REC, &req);
+    if (err != 0) {
+        puts("user start rec err\n");
+        goto __exit;
+    }
+    req.rec.packet_cb = stream_packet_cb;//Ê≥®ÂÜåÊï∞ÊçÆÂåÖÂõûË∞ÉÂáΩÊï∞ËøõË°åÂçèËÆÆËΩ¨Âèë
+    err = server_request(__this_user->user_video_rec, VIDEO_REQ_SET_PACKET_CALLBACK, &req);
+    if (err != 0) {
+        puts("stream_packet_cb set err\n");
+        goto __exit;
+    }
+    err = stream_protocol_task_create(path, NULL);//ÂçèËÆÆËΩ¨Âèë‰ªªÂä°ÂàõÂª∫
+    if (err != 0) {
+        puts("stream_packet_cb set err\n");
+        goto __exit;
+    }
+    set_video_rt_cb(user_video_frame_callback);
+    __this_user->state = true;
+    printf("user video rec open ok\n");
+
+    return err;
+
+__exit:
+    if (__this_user->user_video_rec) {
+        memset(&req, 0, sizeof(req));
+        req.rec.channel = 1;
+        req.rec.state = VIDEO_STATE_STOP;
+        server_request(__this_user->user_video_rec, VIDEO_REQ_REC, &req);
+        server_close(__this_user->user_video_rec);
+        __this_user->user_video_rec = NULL;
+    }
+    if (__this_user->user_video_buf) {
+        free(__this_user->user_video_buf);
+        __this_user->user_video_buf = NULL;
+    }
+    if (__this_user->user_audio_buf) {
+        free(__this_user->user_audio_buf);
+        __this_user->user_audio_buf = NULL;
+    }
+#if !USER_ISC_STATIC_BUFF_ENABLE
+    if (__this_user->user_isc_buf) {
+        free(__this_user->user_isc_buf);
+        __this_user->user_isc_buf = NULL;
+    }
+#endif
+#endif
+
+    return err;
+}
+
+/*
+ *Áî®Êà∑VIDEOÂÖ≥Èó≠
+ */
+int user_video_rec0_close(void)
+{
+    int err = 0;
+#ifdef CONFIG_USR_VIDEO_ENABLE
+    union video_req req = {0};
+    if (__this_user->user_video_rec) {
+        req.rec.channel = 1;
+        req.rec.state = VIDEO_STATE_STOP;
+        err = server_request(__this_user->user_video_rec, VIDEO_REQ_REC, &req);
+        if (err != 0) {
+            printf("\nstop rec err 0x%x\n", err);
+            return -1;
+        }
+        server_close(__this_user->user_video_rec);
+        stream_protocol_task_kill();
+        __this_user->user_video_rec = NULL;
+        __this_user->state = false;
+        printf("user video rec close ok\n");
+    }
+    if (__this_user->user_video_buf) {
+        free(__this_user->user_video_buf);
+        __this_user->user_video_buf = NULL;
+    }
+    if (__this_user->user_audio_buf) {
+        free(__this_user->user_audio_buf);
+        __this_user->user_audio_buf = NULL;
+    }
+#if !USER_ISC_STATIC_BUFF_ENABLE
+    if (__this_user->user_isc_buf) {
+        free(__this_user->user_isc_buf);
+        __this_user->user_isc_buf = NULL;
+    }
+#endif
+#endif
+    return 0;
+}
+
+
+
Index: video_rt_usr.c
===================================================================
--- video_rt_usr.c	(nonexistent)
+++ video_rt_usr.c	(working copy)
@@ -0,0 +1,49 @@
+#include "server/rt_stream_pkg.h"
+#include "stream_core.h"
+#include "sock_api/sock_api.h"
+
+/**************************************************************************************************************
+ÂΩìÊâìÂºÄvideo_rt_usr_init()ÂáΩÊï∞ËøîÂõûÈùûNULLÔºåÊâìÂºÄÂÆåÊàê‰πãÂêéÔºåÊúâÊï∞ÊçÆ‰ºöË∞ÉÁî®Âà∞video_rt_usr_send()ÂáΩÊï∞Ôºå
+	typeÁöÑÁ±ªÂûãÊòØJPEG_TYPE_VIDEOÂàô‰∏∫ËßÜÈ¢ëÂ∏ßÔºåPCM_TYPE_AUDIOÂàô‰∏∫Èü≥È¢ë„ÄÇ
+**************************************************************************************************************/
+static u32(*video_rt_cb)(void *buf, u32 len, u8 type);
+
+void set_video_rt_cb(u32(*cb)(void *buf, u32 len, u8 type))
+{
+    video_rt_cb = cb;
+}
+
+static void *video_rt_usr_init(const char *path, const char *mode)
+{
+    //ËøûÊé•ÊúçÂä°Âô®Êìç‰Ωú
+    puts("video_rt_usr_init\n");
+
+    return calloc(1, sizeof(struct rt_stream_info));
+}
+
+static int video_rt_usr_send(void *hdr, void *data, u32 len, u8 type)
+{
+    struct rt_stream_info *r_info = (struct rt_stream_info *)hdr;
+
+    if (video_rt_cb) {
+        video_rt_cb(data, len, type);
+    }
+
+    return len;
+}
+
+static int video_rt_usr_uninit(void *hdr)
+{
+    puts("video_rt_usr_uninit\n");
+    struct rt_stream_info *r_info = (struct rt_stream_info *)hdr;
+    free(r_info);
+    return 0;
+}
+
+REGISTER_NET_VIDEO_STREAM_SUDDEV(usr_video_stream_sub) = {
+    .name = "usr",
+    .open =  video_rt_usr_init,
+    .write = video_rt_usr_send,
+    .close = video_rt_usr_uninit,
+};
+
